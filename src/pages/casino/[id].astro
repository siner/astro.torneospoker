---
import Layout from "../../layouts/Layout.astro";
import CardCasino from "../../components/casino/CardCasino";
import RowTournament from "../../components/tournament/RowTournament";
import RowCashgame from "../../components/cashgame/RowCashgame";

const id = Astro.params.id;
import {
  getCasino,
  getProximosTorneosCasino,
  getCashgamesCasino,
} from "../../lib/api";
let casino = await getCasino(id);
let torneos = await getProximosTorneosCasino(id);
let cashgames = await getCashgamesCasino(id);

import { getUser, isAdmin } from "../../lib/auth";
const user = await getUser(Astro.request);
let is_admin;
if (user) {
  is_admin = await isAdmin(user.id);
}
---

<Layout title={casino.name} description={"Casino " + casino.name}>
  <div class="mx-5">
    <div class="md:flex gap-4">
      <div class="w-100 md:w-1/3 mt-6">
        <CardCasino casino={casino} />
        {
          is_admin && (
            <div class="p-5 text-right">
              <a
                class="bg-yellow-500 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                href={"/admin/casino/" + casino.id}>
                Editar
              </a>
            </div>
          )
        }
      </div>
      <div class="md:w-2/3">
        <h2 class="text-4xl font-bold py-4">Pr√≥ximos Torneos</h2>
        <div class="space-y-0.5">
          {
            torneos.map((torneo) => (
              <RowTournament torneo={torneo} casino="false" />
            ))
          }
        </div>

        <h2 class="text-4xl font-bold py-4">Cash</h2>
        <div class="space-y-0.5">
          {cashgames.map((cashgame) => <RowCashgame cashgame={cashgame} />)}
        </div>
      </div>
    </div>
  </div>
</Layout>
